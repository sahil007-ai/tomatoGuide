# Teacher Report Verification Guide

This document explains how teachers can verify and decrypt student focus reports generated by the Focus Guard application.

---

## Overview

Students can generate **encrypted, tamper-proof reports** that document their focus sessions. These reports are:

- **Encrypted**: Only the teacher with the private key can read the contents
- **Signed**: Any tampering with the report will be detected during verification
- **Unfalsifiable**: Students cannot modify report data without invalidating the signature

---

## Setup (One-Time)

### 1. Generate Teacher Keypair

Run the verification script to generate your RSA keypair:

```bash
python verify_report.py --generate-keypair
```

This creates two files:

- `teacher_private.pem` - **Keep this SECRET and SECURE**
- `teacher_public.pem` - Share this with your students

**IMPORTANT**:

- Store `teacher_private.pem` in a secure location
- Never share your private key with anyone
- Back up your private key in a safe place

### 2. Distribute Public Key to Students

Give `teacher_public.pem` to your students. They will:

1. Open Focus Guard
2. Enable "Teacher Reports" in the accountability section
3. Click "Load teacher key" and select `teacher_public.pem`
4. Generate reports that are encrypted for you

---

## Verifying Student Reports

### Command

```bash
python verify_report.py --private-key teacher_private.pem --report student_report.json
```

### Example Output

```
============================================================
VERIFIED STUDENT FOCUS REPORT
============================================================

Report Timestamp:     2026-02-21 14:30:00
Sessions Completed:   4
Total Focus Time:     95 minutes
Total Distractions:   3
Last Session Distr.:  1

Distraction Rate:     1.9 per hour
Focus Quality:        Excellent

============================================================
✓ Report signature verified (tamper-proof)
✓ Decryption successful (authentic source)
============================================================
```

### Focus Quality Ratings

| Distraction Rate | Quality           |
| ---------------- | ----------------- |
| < 3 per hour     | Excellent         |
| 3-6 per hour     | Good              |
| 6-10 per hour    | Fair              |
| > 10 per hour    | Needs Improvement |

---

## Report Fields

| Field                       | Description                             |
| --------------------------- | --------------------------------------- |
| `timestamp`                 | When the report was generated           |
| `sessions_completed`        | Number of completed focus sessions      |
| `total_focus_minutes`       | Total focused work time in minutes      |
| `total_distractions`        | Total number of detected distractions   |
| `last_session_distractions` | Distractions in the most recent session |

---

## Security Features

### 1. Digital Signature (Tamper Detection)

- Each report is signed with the student's app-generated private key
- Any modification to the report data invalidates the signature
- Verification confirms the report hasn't been altered

### 2. Encryption (Confidentiality)

- Report contents are encrypted using your public key
- Only you (with the private key) can decrypt and read the report
- Students cannot read the encrypted report themselves

### 3. Non-Repudiation

- The app public key is embedded in each report
- You can identify which app instance generated each report
- Students cannot deny generating a report

---

## Troubleshooting

### Error: "Decryption failed. Wrong private key?"

**Cause**: The report was encrypted for a different teacher public key.

**Solution**: Ensure the student loaded the correct `teacher_public.pem` that matches your `teacher_private.pem`.

### Error: "Signature verification failed"

**Cause**: The report has been tampered with or corrupted.

**Solution**: Request a fresh report from the student.

### Error: "cryptography library not installed"

**Cause**: Missing Python dependency.

**Solution**: Install the cryptography library:

```bash
pip install cryptography
```

---

## Best Practices

1. **Protect Your Private Key**
   - Store `teacher_private.pem` securely (encrypted folder, password manager)
   - Never email or share it
   - Create backups in secure locations

2. **Distribute Public Key Safely**
   - Email, USB, or learning management system
   - Verify students have loaded the correct key

3. **Regular Verification**
   - Verify reports promptly to detect issues early
   - Check that timestamps align with expected work periods

4. **Key Rotation**
   - Consider generating new keypairs each semester/year
   - Archive old private keys to verify historical reports

---

## Batch Verification (Advanced)

To verify multiple reports:

```bash
# Linux/macOS
for report in reports/*.json; do
    echo "Verifying: $report"
    python verify_report.py --private-key teacher_private.pem --report "$report"
    echo ""
done

# Windows PowerShell
Get-ChildItem reports\*.json | ForEach-Object {
    Write-Host "Verifying: $_"
    python verify_report.py --private-key teacher_private.pem --report $_
    Write-Host ""
}
```

---

## FAQ

**Q: Can students fake reports?**

A: No. Reports are cryptographically signed and cannot be modified without detection. Students cannot read or alter the encrypted content.

**Q: What if a student loses their app keypair?**

A: The student can continue generating reports with a new app keypair. Each report includes the app's public key for verification.

**Q: Can I verify old reports if I generate a new keypair?**

A: No. Reports encrypted with the old public key require the old private key. Always keep archived private keys for historical reports.

**Q: What if my private key is compromised?**

A: Generate a new keypair immediately and distribute the new public key to students. Historical reports can still be verified with the old (compromised) key.

---

## Support

For issues or questions:

1. Check the [main README](README.md)
2. Review the [troubleshooting guide](SETUP_GUIDE.md)
3. Contact the application maintainer

---

**Document Version**: 1.0  
**Last Updated**: February 21, 2026
